pip install torch==1.12.1+cu113 torchvision==0.13.1+cu113 --extra-index-url https://download.pytorch.org/whl/cu113
pip install onnxruntime==1.16.3
pip install onnx==1.15.0
pip install requests
pip install nvidia-pyindex
pip install onnx-graphsurgeon
pip install opencv-python-headless
pip install pandas
pip install IPython
pip install psutil
pip install pyyaml
pip install tqdm
pip install matplotlib
pip install seaborn
pip install ipdb

python torch2onnx.py --weights c3-best.pt --output c3-best.onnx
python add_nms_plugins.py --model c3-best.onnx 
/usr/src/tensorrt/bin/trtexec --onnx=c3-best-nms.onnx --saveEngine=c3-best-nms.trt --minShapes=input:1x3x640x640 --optShapes=input:3x3x640x640 --maxShapes=input:4x3x640x640 --verbose --device=0

python3 object_detector_trt_nms.py --classes data/tiip.names --weight c3-best-nms.trt --img_test images/samples/1698908493037728.jpg 



# converted end-to-end version
python torch2onnx.py --weights c3-converted.pt --output c3-converted-e2e.onnx --e2e
python add_nms_plugins.py --model c3-converted-e2e.onnx 
/usr/src/tensorrt/bin/trtexec --onnx=c3-converted-e2e-nms.onnx --saveEngine=c3-converted-e2e-nms.trt --minShapes=input:1x1280x1920x3 --maxShapes=input:3x1280x1920x3 --optShapes=input:3x1280x1920x3 --verbose --device=0
python3 object_detector_trt_nms.py --classes data/tiip.names --weight c3-converted-e2e-nms.trt --e2e



python torch2onnx.py --weights c7-converted.pt --output c7-converted.onnx
python add_nms_plugins.py --model c7-converted.onnx
/usr/src/tensorrt/bin/trtexec --onnx=c7-converted-nms.onnx --saveEngine=c7-converted-nms.trt --minShapes=input:1x640x640x3 --maxShapes=input:3x640x640x3 --optShapes=input:3x640x640x3 --verbose --device=0
/usr/src/tensorrt/bin/trtexec --onnx=c7-converted-nms.onnx --saveEngine=c7-converted-nms.trt --minShapes=input:1x3x640x640 --maxShapes=input:3x3x640x640 --optShapes=input:3x3x640x640 --verbose --device=0
python3 object_detector_trt_nms.py --classes data/tiip.names --weight c7-converted-nms.trt


unconverted 36 ms
converted 30 ms
add postprocess 30 ms
add preprocess 45 ms
converted int8 20 ms (without nms)


# environment for running object_detector_trt_nms.py on orin
sudo apt-get install python3-dev
ls /usr/local/cuda-11.4/targets/aarch64-linux/lib
sudo apt install libboost-all-dev --fix-missing
export CPATH=$CPATH:/usr/local/cuda-11.4/targets/aarch64-linux/include
export LIBRARY_PATH=$LIBRARY_PATH:/usr/local/cuda-11.4/targets/aarch64-linux/lib
pip install pycuda==2022.2


# tritonserver inference
cd /home/ubuntu/tritonserver/bin
./tritonserver \
  --model-repository=/home/ubuntu/julian/work/yolov9-tensorrt/triton/models/ \
  --backend-directory=/home/ubuntu/tritonserver/backends
python triton_infer.py